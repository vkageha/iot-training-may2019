# System Design for the IoT Server

Please find my rationale for making certain decisions on how the system may work, please note this is only a proposal of how I would solve the problem, you may come up with a different way you would like to organize the project. This document contains a high level system description together with the routes

## Our Data Models

A data model is as the name suggests is a definition of the logical organization of our data, it is the ground truth of the data we are storing in the system. We are using mongoDB, and our data is organized into collections. The system is simple, and after reviewing the requirements we were given of the IoT System, I think 3 collections will do the job. Defining the collections will help us model our data. The 3 collections are: - **telemetry** - this collection will store data about the devices. Each document will have a temprature field, humidity field, timestamp field, unique_id of the data point(generated by Mongo itself), and a sensor_id field which will reference the 'devices' collection. We need the sensor_id field because we might have several sensors and we want to know which sensor is sending the telemetry - **device**- this collection will store data about the devices that are in our system - though our immediate implementation will only have one device, it is possible that we may want to have more devices in our system. The documents in this collection will have the following fields - device_name,unique_id(generated by Mongo),latitude,longitude - **user** - this collection will manage the users. Remember we need to automatically alert the administrator(s) in case the temprature exceeds a certain level.We need to store information about all these administrators in a different collection- the fields include firstNAme,lastName,phone,email

## Our Routes

I usually end up dividing the routes in line with the models - you may find a better way to logically group your routes, just make sure they make sense to another developer who may be using your RESTful services

### Routes

#### telemetry

    - GET telemetry/:deviceId - get all telemetry for a particular device Id in this case the device is specified as as a path parameter, which specifies what particular device data you want
    - POST telemetry/:deviceId - store a data point(basically a json datapoint for a particular device specified in the deviceId path parameter). Please note that for you to begin to send telemtry from the user, you will need to create a device first.

#### device

    - POST device/createnewdevice - create a new device in our system(in the device collection). You will need to provide data about the name, location(latitude and longitude) of the device as specified in the models. This will be attached in the body of the request.
    - GET device/getalldevices - this route gets the details of all devices in the system -returns a JSON array with the objects representing all devices in your system
    - GET device/getsingledevice/:deviceId - get the details of a single device. You will need to specify the device Id as a path parameter
    - PATCH device/editdevice/:deviceId - edit a single device you already created in the system

#### user

    - POST user/createnewuser - create a new user in our system(in the user collection). You will need to provide data about the firstName,lastName,phone,email of the user as specified in the models. This will be attached in the body of the request.
    - GET user/getallusers - this route gets the details of all users in the system -returns a JSON array with the objects representing all users in our system
    - GET user/getsingleuser/:userId - get the details of a single user. You will need to specify the user Id as a path parameter
    - PATCH user/edituser/:userId - edit a single user you already created in the system

You will see some similarities between the device and user collections, they are basically CRUD(Create Read Update Delete) end points.

### Controllers

As I explained, controllers carry the logic of what your app is doing. You could ideally skip them, and write your handler functions on the route objects but this can get out of hand for a large application. So it may be better to split your application further into controllers which actually handle the request. I have created dummy controllers for all the routes(I also usually end up having a one to one route to controller mapping, but this is up to you too!).

I have created the routes and controllers for the application. This is my proposal, you may choose to change it. Please review it and find areas you may not understand, so we may discuss in our next class(We are moving a bit too slow, so writing all this in class may take a while, and most of them is just a repetetion with very little change). I have tried as mush as I can to add comments to what I am doing. Go through this and try to see that you have an idea of what is going on.
